# nginx

description "nginx http daemon"

start on (local-filesystems and net-device-up IFACE=lo and runlevel [2345])
stop on runlevel [!2345]

setuid <%= @user %>
setgid <%= @user %>

env DAEMON=/opt/nginx-1.4.4/sbin/nginx
env PID=/var/run/nginx.pid
env CONFIG=/etc/nginx/nginx.conf

respawn

pre-start script
  ${DAEMON} -t
  if [ $? -ne 0 ]; then
    exit $?
  fi
end script

expect fork

exec ${DAEMON} -c "${CONFIG}"